{{> common/header}}
<link rel="stylesheet" href="/css/sidebarstyles.css">
<link rel="stylesheet" href="/css/headerstyles.css">

<style>
    /* ✅ 중앙 정렬 */
    .container {
        display: flex;
        flex-direction: column; /* 이미지 검수, 과정 박스 정렬 세로 */
        /*margin-left: -500px; */
        justify-content: center;  /* 화면 중앙 정렬 */
    }

    .content {
        flex: 1;
        padding: 20px;
        text-align: center;
        width: calc(100% - 220px); /* 사이드바 너비 제외 */
        margin-left: 220px; /* 사이드바 크기만큼 왼쪽에서 이동 */
        overflow: hidden; /* 넘치는 부분을 숨김 */
    }

    /* 이미지 크기 조정 */
    .image-wrapper img {
        width: auto;
        max-width: 100%; /* 화면 크기를 초과하지 않도록 제한 */
        height: auto;
        border: 2px solid #ccc;
        margin-top: 10px;
    }

    /* ✅ 여백 추가 */
    #uploadForm {
        margin-bottom: 20px;
    }

    /* ✅ 결과 영역 스타일 */
    #resultContainer {
        display: none;
        margin-top: 20px;
    }

    .image-container {
        display: flex;
        justify-content: center;
        gap: 50px;
    }

    h3 {
        font-size: 1.8rem;
        font-weight: bold;
        text-align: center;
        margin-bottom: 16px; /* ✅ 아래 여백 추가 */
        display: inline-block;
        color: rgba(40, 40, 43, 0.78);
    }


    .icon-container { /* 과정 박스 아이콘 전체 */
        display: flex;
        justify-content: center;
        gap: 20px;
        padding: 12px 80px; /* ✅ 상하, 좌우 여백 */
        background-color: #f8f9fa; /*  배경 색상 */
        border-radius: 12px; /* 둥근 모서리 */
        box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1); /* 부드러운 그림자 효과 */
        margin-top: -100px; /* 과정박스, 이미지 검수 같이. 내려고 */
        margin-bottom: 240px; /* 아이콘과 이미지 검수 사이 간격. 내려고*/
        margin-left: 225px;

    }

    .icon-box img {
        width: 65px; /* 과정 아이콘 크기 */
        height: 65px;
        margin-left: 47px;
        margin-right: 47px;
    }
    .icon-box-yolo img {
        width: 150px; /* 과정 아이콘 크기 */
        height: auto;
    }
    .icon-box-shift img {
        width: 40px; /* 이동 아이콘 크기 */
        height: auto;
    }
    .icon-box-shift-star img {
        width: 40px; /* 이동 아이콘 크기 */
        height: auto;
    }


    .icon-box p, .icon-box-yolo p {
        margin-top: 10px;
        font-size: 16px;


    }

    @keyframes moveBlink {
        0% { opacity: 1; transform: translateX(0); }
        50% { opacity: 0; transform: translateX(20px); }
        100% { opacity: 1; transform: translateX(0); }
    }

    /* 기본 상태에서는 깜박이지 않음 */
    .icon-box-shift-star img {
        width: 40px; /* 이동 아이콘 크기 */
        height: auto;
        display: block; /* 기본적으로 보이게 설정 */
    }

    /* 깜박이는 아이콘 (초기에는 숨김) */
    .blink-shift {
        width: 40px;
        height: auto;
        display: none; /* 기본적으로 숨김 */
        animation: moveBlink 1s infinite;
    }

</style>

<div class="container">
    {{> common/sidebar}}

    <div class="icon-container">
        <div class="icon-box">
            <img src="/img/cctv-icon.png" alt="CCTV">
            <p>CCTV</p>
        </div>
        <div class="icon-box-shift">
            <img src="/img/right-icon.png" alt="이동중">
        </div>
        <div class="icon-box">
            <img src="/img/frame-icon.png" alt="프레임 분리">
            <p>프레임 분리</p>
        </div>
        <div class="icon-box-shift">
            <img src="/img/right-icon.png" alt="이동중">
        </div>
        <div class="icon-box-yolo">
            <img src="/img/yolo-icon.png" alt="YOLO">
            <p>YOLO</p>
        </div>
        <div class="icon-box-shift-star">
            <img src="/img/right-icon.png" alt="이동중">
            <img id="loadingIcon" class="blink-shift" src="/img/right_shift.png" alt="로딩중" style="display: none;">
        </div>
        <div class="icon-box">
            <img src="/img/classification-icon.png" alt="물품 분류">
            <p>물품 분류</p>
        </div>
    </div>

    <div class="content">
        <h2>이미지 검수</h2>

        <form id="uploadForm" enctype="multipart/form-data">
            <input type="file" id="fileInput" required>
            <button type="submit">검수 시작</button>
        </form>

        <div id="resultContainer">
<!--          <h3>Fine-tuning the YOLO V11 model on goods & food data</h3>  -->
            <div class="image-container">
                <div class="image-wrapper">
                    <img id="originalImage" src="" alt="Original Image">
                    <h4>Default Image</h4>
                </div>
                <div class="image-wrapper">
                    <img id="detectedImage" src="" alt="Detected Image">
                    <h4>Detected Image</h4>
                </div>
            </div>
        </div>
    </div>
</div>

{{> common/footer}}

<script>
    document.getElementById("uploadForm").onsubmit = async function(event) {
        event.preventDefault();

        const fileInput = document.getElementById("fileInput").files[0];
        const formData = new FormData();
        formData.append("file", fileInput);

        const defaultIcon = document.getElementById("defaultIcon");
        const loadingIcon = document.getElementById("loadingIcon");

        // 기존 아이콘 숨기고 새 아이콘 표시
        if (defaultIcon && loadingIcon) {
            defaultIcon.style.display = "none"; // 기존 아이콘 숨기기
            loadingIcon.style.display = "block"; // 새 아이콘 보이기 (애니메이션 포함)
        }

        try {
            const response = await fetch("/inspection/inspect", {
                method: "POST",
                body: formData
            });

            if (response.ok) {
                const result = await response.json();
                document.getElementById("originalImage").src = "data:image/jpeg;base64," + result.original_image;
                document.getElementById("detectedImage").src = "data:image/jpeg;base64," + result.detected_image;
                document.getElementById("resultContainer").style.display = "block";
            } else {
                alert("검수 실패!");
            }
        } catch (error) {
            alert("오류 발생!");
        } finally {
            // 기존 아이콘 다시 보이고, 새 아이콘 숨기기
            if (defaultIcon && loadingIcon) {
                defaultIcon.style.display = "block"; // 기존 아이콘 다시 보이기
                loadingIcon.style.display = "none"; // 로딩 아이콘 숨기기
            }
        }

    };
</script>
